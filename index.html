<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CiddApp - Registrar Ocorrência</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <header>
    <h1>CiddApp</h1>
    <nav>
      <a href="login.html">Entrar</a> | <a href="professor.html">Acesso Professor</a>
    </nav>
  </header>

  <main>
    <section class="map-section">
      <h2>Mapa de Ocorrências</h2>
      <div id="map" style="height: 400px;"></div>
    </section>

    <section class="form-section">
      <h2>Registrar Ocorrência</h2>
      <form id="reportForm">
        <label>Título <input name="title" required /></label>
        <label>Descrição <textarea name="description" required></textarea></label>
        <label>Latitude <input name="lat" required /></label>
        <label>Longitude <input name="lng" required /></label>
        <label>Foto <input type="file" name="photo" accept="image/*" /></label>
        <button type="submit">Enviar</button>
      </form>
      <div id="msg"></div>
    </section>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="js/app.js"></script>
</body>
</html>

<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CiddApp - Painel Professor</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <main>
    <h2>Painel do Professor</h2>
    <div id="welcome"></div>
    <div id="stats"></div>
    <button id="logout">Sair</button>
  </main>

  <script>
    const token = localStorage.getItem('token');
    const role = localStorage.getItem('role');
    document.getElementById('welcome').innerText = 'Olá, ' + (localStorage.getItem('name') || 'Professor');

    if (!token || role !== 'professor') {
      alert('Acesso restrito a professores. Faça login com uma conta de professor.');
      window.location.href = '/login.html';
    } else {
      fetch('http://localhost:4000/api/reports/report/pdf', {
        headers: { 'Authorization': 'Bearer ' + token }
      }).then(r => r.json()).then(data => {
        document.getElementById('stats').innerText = 'Total de ocorrências: ' + data.total + '\nStatus: ' + JSON.stringify(data.byStatus);
      }).catch(err => {
        document.getElementById('stats').innerText = 'Erro ao obter relatórios';
      });
    }

    document.getElementById('logout').addEventListener('click', () => {
      localStorage.clear();
      window.location.href = '/login.html';
    });
  </script>
</body>
</html>
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CiddApp - Login</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <main class="center">
    <h2>Login</h2>
    <form id="loginForm">
      <label>Email <input type="email" name="email" required /></label>
      <label>Senha <input type="password" name="password" required /></label>
      <button type="submit">Entrar</button>
    </form>
    <div id="msg"></div>
  </main>
  <script>
    const api = 'http://localhost:4000/api/auth/login';
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const f = e.target;
      const body = { email: f.email.value, password: f.password.value };
      const res = await fetch(api, { method: 'POST', headers: { 'Content-Type':'application/json' }, body: JSON.stringify(body) });
      const data = await res.json();
      if (res.ok) {
        localStorage.setItem('token', data.token);
        localStorage.setItem('role', data.role);
        localStorage.setItem('name', data.name);
        alert('Login realizado!');
        window.location.href = '/index.html';
      } else {
        document.getElementById('msg').innerText = data.message || JSON.stringify(data);
      }
    });
  </script>
</body>
</html>
